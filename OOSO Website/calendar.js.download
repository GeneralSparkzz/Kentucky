// Title: Timestamp picker
// Description: See the demo at url
// URL: http://www.geocities.com/tspicker/
// Version: 1.0.a (Date selector only)
// Date: 12-12-2001 (mm-dd-yyyy)
// Author: Denis Gritcyuk <denis@softcomplex.com>; <tspicker@yahoo.com>
// Notes: Permission given to use this script in any kind of applications if
//    header lines are left unchanged. Feel free to contact the author
//    for feature requests and/or donations

//calendar variables
Xmu = 0;
Ymu = 0;
// isNav is true if the browser is Netscape, otherwise is false
isNav = (navigator.appName.indexOf("Netscape") != -1) ? true : false;
isIE = (navigator.appName.indexOf("Microsoft") != -1) ? true : false;

// This function is used to position a new window from
// the x and y position that the user has just clicked
function handlerMU(e)
{
// Get the absolute screen coordinates of the event:
    Xmu = event.screenX;
    Ymu = event.screenY; 
}

// Capture browser events
if (isNav)
{
 document.captureEvents(Event.MOUSEDOWN);
}
else
{
 document.onmousedown = handlerMU;
}



function show_calendar(str_target, str_datetime, path) {
    
	var arr_months = ["January", "February", "March", "April", "May", "June",
		"July", "August", "September", "October", "November", "December"];
	var week_days = ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"];
	var n_weekstart = 1; // day week starts from (normally 0 or 1)
  
	var dt_datetime = (str_datetime == null || str_datetime =="" ?  new Date() : str2dt4(str_datetime));
    
    var dt_prev_year = new Date(dt_datetime);
    //dt_prev_year.setYear(dt_datetime.getYear()-1);
    dt_prev_year.setYear(dt_datetime.getFullYear()-1);
       
    var dt_next_year = new Date(dt_datetime);
    //dt_next_year.setYear(dt_datetime.getYear()+1);
	dt_next_year.setYear(dt_datetime.getFullYear()+1);

	var dt_prev_month = new Date(dt_datetime);
	dt_prev_month.setMonth(dt_datetime.getMonth()-1);
    
	var dt_next_month = new Date(dt_datetime);
	dt_next_month.setMonth(dt_datetime.getMonth()+1);
	
    var dt_firstday = new Date(dt_datetime);
	dt_firstday.setDate(1);
	dt_firstday.setDate(1-(7+dt_firstday.getDay()-n_weekstart)%7);
	var dt_lastday = new Date(dt_next_month);
	dt_lastday.setDate(0);
    
	// html generation (feel free to tune it for your particular application)
	// print calendar header
//alert(dt_next_month + " }{ "+ dt2dtstr4(dt_next_month));		
	var str_buffer = new String (  
		"<html>\n"+
		"<head>\n"+
		"	<title>Calendar</title>\n"+
		"</head>\n"+
//	white background:  "<body bgcolor=\"White\" onblur=\"window.focus()\">\n"+
        "<body bgcolor=\"#FFFFEC\" >\n"+
		"<table class=\"clsOTable\" cellspacing=\"0\" border=\"0\" width=\"100%\">\n"+
		"<tr><td bgcolor=\"#4682B4\">\n"+
		"<table cellspacing=\"1\" cellpadding=\"3\" border=\"0\" width=\"100%\">\n"+
        
        //previous year, month
        "<tr>\n  <td bgcolor=\"#4682B4\"><a href=\"javascript:window.opener.show_calendar('"+
         str_target+"', '"+dt2dtstr4(dt_prev_year)+ "', '" + path + "');\">"+
        "<img src=\""+path+"prev_year.gif\" width=\"16\" height=\"16\" border=\"0\""+
        " alt=\"previous year\"></a></td>\n"+
 		"	<td bgcolor=\"#4682B4\"><a href=\"javascript:window.opener.show_calendar('"+
		 str_target+"', '"+dt2dtstr4(dt_prev_month)+ "', '" + path + "');\">"+
		"<img src=\""+path+"prev_month.gif\" width=\"16\" height=\"16\" border=\"0\""+
		" alt=\"previous month\"></a></td>\n"+
	    
        //current date label
    	"	<td bgcolor=\"#4682B4\" colspan=\"3\" nowrap align=\"center\">"+
		"<font color=\"white\" face=\"tahoma, verdana\" size=\"1\">"+
		 arr_months[dt_datetime.getMonth()]+" "+dt_datetime.getFullYear()+"</font></td>\n"+
	
        //next month, year
    	"	<td bgcolor=\"#4682B4\" align=\"right\"><a href=\"javascript:window.opener.show_calendar('"+
		 str_target+"', '"+dt2dtstr4(dt_next_month)+ "', '" + path + "');\">"+
		"<img src=\""+path+"next_month.gif\" width=\"16\" height=\"16\" border=\"0\""+
		" alt=\"next month\"></a></td>\n "+
        "        <td bgcolor=\"#4682B4\" align=\"right\"><a href=\"javascript:window.opener.show_calendar('"+
         str_target+"', '"+dt2dtstr4(dt_next_year)+ "', '" + path + "');\">"+
        "<img src=\""+path+"next_year.gif\" width=\"16\" height=\"16\" border=\"0\""+
        " alt=\"next year\"></a></td>\n"+
        "</tr>\n"
	);

	var dt_current_day = new Date(dt_firstday);
	// print weekdays titles
	str_buffer += "<tr>\n";
	for (var n=0; n<7; n++)
		str_buffer += "	<td bgcolor=\"#87CEFA\" width=\"14%\">"+
		"<font color=\"white\" face=\"tahoma, verdana\" size=\"2\">"+
		week_days[(n_weekstart+n)%7]+"</font></td>\n";
        
	// print calendar table
	str_buffer += "</tr>\n";
	while (dt_current_day.getMonth() == dt_datetime.getMonth() ||
		dt_current_day.getMonth() == dt_firstday.getMonth()) {
		// print row heder
		str_buffer += "<tr>\n";
		for (var n_current_wday=0; n_current_wday<7; n_current_wday++) {
				if (dt_current_day.getDate() == dt_datetime.getDate() &&
					dt_current_day.getMonth() == dt_datetime.getMonth())
					// print current date
					str_buffer += "	<td bgcolor=\"#FFB6C1\" align=\"right\">";
				else if (dt_current_day.getDay() == 0 || dt_current_day.getDay() == 6)
					// weekend days
					str_buffer += "	<td bgcolor=\"#DBEAF5\" align=\"right\">";
				else
					// print working days of current month
					str_buffer += "	<td bgcolor=\"white\" align=\"right\">";

				if (dt_current_day.getMonth() == dt_datetime.getMonth())
					// print days of current month
					str_buffer += "<a href=\"javascript:window.opener."+str_target+
					".value='"+dt2dtstr4(dt_current_day)+"'; window.close(); opener." + str_target + ".focus();\">"+
					"<font color=\"black\" face=\"tahoma, verdana\" size=\"2\">";
				else 
					// print days of other months
					str_buffer += "<a href=\"javascript:window.opener."+str_target+
					".value='"+dt2dtstr4(dt_current_day)+"'; window.close(); opener." + str_target + ".focus();\">"+
					"<font color=\"gray\" face=\"tahoma, verdana\" size=\"2\">";
				str_buffer += dt_current_day.getDate()+"</font></a></td>\n";
				dt_current_day.setDate(dt_current_day.getDate()+1);
		}
		// print row footer
		str_buffer += "</tr>\n";
	}
	
	// print calendar footer
	str_buffer +=
		"</table>\n" +
		"</tr>\n</td>\n</table>\n" +
		"</body>\n" +
		"</html>\n";
		
//****************************************************************************************		
//    The final popup window position towards the cursor has to be hardcoded in pixels:

    //calculations to always show popup window in the available screen area
    if (Xmu < 165)
      Xmu = 0;
    else if (Xmu > (screen.availWidth - 40))
      Xmu = screen.availWidth - 210;
    else
      Xmu = (Xmu - 163);

    if (Ymu > (screen.availHeight - 235))
      Ymu = screen.availHeight - 235;
    else
      Ymu = (Ymu + 10);

    //popup the calendar window
    vWinCal = window.open("", "Calendar", "width=200, height=210, toolbar=no, status=no, location=no, directories=no, resizable=no, menubar=no, alwaysRaised=yes, top=" + Ymu + ", left=" + Xmu);
	vWinCal.opener = self;
	vWinCal.focus();
	var calc_doc = vWinCal.document;
	calc_doc.write (str_buffer);
	calc_doc.close();
}

// datetime parsing and formatting routimes. Modify them if you wish other datetime format
function str2dt4 (str_datetime) {
	var re_date = /^(\d+)\/(\d+)\/(\d+)$/;
	if (!re_date.exec(str_datetime))
		return alert("Invalid Date format: "+ str_datetime);
	return (new Date (RegExp.$3, RegExp.$1-1, RegExp.$2));
}

function dt2dtstr4 (dt_datetime) 
{
 // add 0 to the month/day if it's less than 10
 (dt_datetime.getMonth()+1) < 10 ? mm="0"+(dt_datetime.getMonth()+1) : mm=(dt_datetime.getMonth()+1);
 dt_datetime.getDate() < 10 ? dd="0"+dt_datetime.getDate() : dd=dt_datetime.getDate();
 
	return (new String (mm+"/"+dd+"/"+dt_datetime.getFullYear()));
 
/*  // return date with month/day without 0 if it's less than 10
	return (new String (
			(dt_datetime.getMonth()+1)+"/"+dt_datetime.getDate()+"/"+dt_datetime.getFullYear()));
*/            
}




